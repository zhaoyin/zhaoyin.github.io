
<main id="main" class="main">
    <div class="main-inner">
        <div class="content-wrap">
            <div id="content" class="content">


                <div id="posts" class="posts-expand">








                    <article class="post post-type-normal " itemscope itemtype="http://schema.org/Article">
                        <link itemprop="mainEntityOfPage" href="http://xcoder.me/2017-05/architecture/系统架构演进/">

                        <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="name" content="小英雄雨来">
      <meta itemprop="description" content="">
      <meta itemprop="image" content="/images/avatar.gif">
    </span>

                        <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="架构演进之旅">
    </span>


                        <header class="post-header">



                            <h2 class="post-title" itemprop="name headline">一个业务系统的架构设计</h2>


                            <div class="post-meta">
          <span class="post-time">





              <span class="post-meta-item-icon">
                <i class="fa fa-calendar-check-o"></i>
              </span>

                <span class="post-meta-item-text">更新于</span>

              <time title="更新于" itemprop="dateModified" datetime="2017-05-30T05:16:34+00:00">
                2017-05-30
              </time>

          </span>


                                <span class="post-category" >

              <span class="post-meta-divider">|</span>

              <span class="post-meta-item-icon">
                <i class="fa fa-folder-o"></i>
              </span>

                <span class="post-meta-item-text">分类于</span>


                <span itemprop="about" itemscope itemtype="http://schema.org/Thing">
                  <a href="/categories/architecture/" itemprop="url" rel="index">
                    <span itemprop="name">architecture</span>
                  </a>
                </span>




            </span>








                                <span id="/2017-05/architecture/系统架构演进/" class="leancloud_visitors" data-flag-title="一个业务系统的架构设计">
               <span class="post-meta-divider">|</span>
               <span class="post-meta-item-icon">
                 <i class="fa fa-eye"></i>
               </span>

                 <span class="post-meta-item-text">阅读次数 </span>

                 <span class="leancloud-visitors-count"></span>
             </span>








                            </div>
                        </header>


                        <div class="post-body" itemprop="articleBody">





                            <a class="post-gallery" target="_blank" itemprop="contents" href="https://s.click.taobao.com/t?e=m%3D2%26s%3DS2FPo9pod%2FMcQipKwQzePCperVdZeJviEViQ0P1Vf2kguMN8XjClAoggAmZh6Xz4dTUCp7J6xLhlPjx8CqYfPWjTbzraVxy7YzvZkCrmclL9U03wBYLV9%2Bdn1BbglxZYxUhy8exlzcpAFEHVckI7b93srg%2FL%2FeD3keUEnoKELDlWYetMiZZgV%2BSx6OrKqagyklzFeKMz7Cd4Qek9OyREeQ%2BdciYQJaT7LNmFwzcjFAU%3D" title="阿里云推广">
                                <img src="http://oqcey66z7.bkt.clouddn.com/public/images/aliyun-ECS-AD/700-90.jpg" height="90" width="700" alt="阿里云推广" />
                            </a>
                            <br/>
                            [本文(一个业务系统的架构设计)原始地址]<a href="http://xcoder.me/2017-05/architecture/系统架构演进/" title="一个业务系统的架构设计">http://xcoder.me/2017-05/architecture/系统架构演进/</a>
                            <p>之前开发了一个包括多端（PC端，移动端，微信端，API）的B2B系统，分享一下系统的架构设计演进。</p>
                            <h2 id="技术选型"><a href="#技术选型" class="headerlink" title="技术选型"></a>技术选型</h2><ul>
                            <li>playframework<br>  无状态<br>  全栈(Hibernate,Netty,Groovy,Cache)<br>  Python运维支持，开发热加载</li>
                            <li>AngularJS<br>  对象操作<br>  双向绑定<br>  模版</li>
                        </ul>
                            <p>这样的技术选型是基于低成本／小规模团队快速上线应用的需要。</p>
                            <p>选择playframework是它让我们从开发到运维都能省去很多成本，对于开发人员只要掌握一定的语法就可以直接关注业务逻辑，不用所有的人都特别深入的学习框架。</p>
                            <ul>
                                <li>自动编译和重载：当编辑Java文件并保存后，刷新浏览器就能立即查看结果。使用playframework开发(生产还是需要重启的)不需要手动编译、部署以及重新启动Web服务器等操作。</li>
                                <li>无状态模型：playframework是真正的无共享框架，为REST而准备。它可以将同一个应用的多个实例分别部署在多台服务器上，因而扩展性非常强。</li>
                                <li>高效的模板引擎：基于表达式语言Groovy的清晰模板引擎，提供了模板的继承、导入以及标签自定义等功能。</li>
                                <li>快速解决错误：当错误发生时，playframework(play1)会在浏览器中显示出错代码块并提示问题发生的确切位置。</li>
                                <li>Full Stack:提供创建Web应用所需的全部功能，集成了Hibernate、OpenID、Memcached等第三方类库。</li>
                                <li>纯Java：playframework(play1)采用Java编写代码，可以方便地使用任何Java类库，并且能够非常好地和Eclipse、Netbeans等IDE集成，只需通过命令生成匹配的项目文件即可。</li>
                                <li>基于非阻塞的IO模型：允许创建基于长轮询和WebSocket的主流Web应用。</li>
                                <li>有趣并且高效：省去了Java应用重启的时间，提高了应用的开发效率。</li>
                            </ul>
                            <p>选择AngularJS是我们的应用更多的是后台应用，在2014年轻量级可选择的还只有knockout和angular，考虑到谷歌以及丰富的控件组件，mvvm的便捷实用我们选择了它，现在它仍然在很好的发挥着作用，在前端开发人手不足时能让后台开发也能以面向对象的方式介入前台开发，以便应用快速上线。</p>
                            <a id="more"></a>
                            <h2 id="架构演进"><a href="#架构演进" class="headerlink" title="架构演进"></a>架构演进</h2><p><img src="http://oqcey66z7.bkt.clouddn.com/public/images/architecture.png" alt="架构演进"></p>
                            <p>我们并不是只用playframework提供的功能而已，在playframework的基础上考虑整体的性能和扩展自定义开发等方面我们在playfamework上做了一些改造</p>
                            <p><img src="http://oqcey66z7.bkt.clouddn.com/public/images/applicationdesign.png" alt="应用设计"></p>
                            <ul>
                                <li>强制使用上下文(控制边界/业务隔离)<br>  这个应用是个多租户的应用，成本考虑不可能每个租户一个库，多个租户在同一个库中就存在租户信息不隔离不安全的问题，我们在数据访问层强制控制，不让业务通过租户字段访问，而是公共部分统一插入租户信息，这样既让业务无须关心租户，当前用户等业务周边信息，也能让类似租户信息更安全。</li>
                                <li>实体缓存(提高效率)<br>  为了提高系统操作效率，我们为每个实体访问都设置了缓存，且无需业务干预和操作。能够极大的提高数据库的IO吞吐量。</li>
                                <li>引入元数据(规范操作,公共问题公共处理)<br>  引入元数据可以让业务有更多可复用，更多可配置及更聚焦业务本身。比如有些业务表需要有审计功能（需要知道某条记录是谁修改，谁添加的），这个业务实体就可以实现审计接口，然后公共统一异步多线程处理审计问题，既能保证高效也能减少耦合。</li>
                                <li>回调机制(解耦/二开)<br>  让业务之间不再通过代码相互调用，减少业务耦合。同时还可以更方便的让二次开发通过这个机制参与进来。</li>
                                <li>playframework服务化(前后端分离/代码复用/更丰富的API)<br>  我们现在并没有让playframework来直接渲染界面，而是将playframework服务化，即它只提供后台多终端服务，前端通过Node.js或PHP来展现，前后端分离，更易维护，也让后端能发挥更大的作用。同时后端还可以随时被更高效的框架或者语言替代（比如scala,go)。</li>
                                <li>Swagger:API量化(测试深入参与后端服务接口测试)<br>  前后台通过标准API文档交互，同时第三方开发者也能有标准规范的开发文档。而且业务接口变更或者新增，文档能够即时的更新，而不用手工操作！</li>
                                <li>大量使用多线程编程来提升系统运行效率<br>  大量的异步多线程操作来保证系统运行效率。</li>
                            </ul>
                            <p>同时我们使用阿里云的OSS来做静态资源(JS/CSS的存储),使用七牛云存储来存储站点的大量图片和附件信息。</p>
                            <ul>
                                <li>解决前端页面加载效率因地区而异</li>
                                <li>节省带宽资源</li>
                                <li>专注业务处理</li>
                                <li>为集群服务铺路</li>
                            </ul>
                            <p>在运维上我们做了一些优化提升</p>
                            <ul>
                                <li>全站HTTPS<br>  避免单点积压<br>  提高处理效率（相对部分HTTPS)<br>  提升系统安全性</li>
                                <li>负载均衡<br>  提升系统稳定性<br>  提升访问性能</li>
                                <li>分布式memcached服务<br>  避免单点雪崩效应<br>  单实体强制缓存化(有效利用缓存分担数据库压力)</li>
                                <li>ELK<br>  提供集群部署下快速分析解决问题的入口和渠道</li>
                                <li>Swagger-API文档<br>  方便前后台分离协同开发及第三方开发者社区规范开发</li>
                            </ul>

                            <a class="post-gallery" target="_blank" itemprop="contents" href="https://s.click.taobao.com/t?e=m%3D2%26s%3DGxUK4RxRAUwcQipKwQzePCperVdZeJviK7Vc7tFgwiFRAdhuF14FMaoDsluWCMrtJ1gyddu7kN%2FjA8%2F%2BZJDLfQ4Zu0ikTBVI5H6lqT7H0fKnLcgY8qPbG6UuZxIcp9pfUIgVEmFmgnaR4ypTBJBwtB6l0bxfYrBpJPwiig1bxLMAV4Err%2B0r%2ByrbHgqSJ08vcSpj5qSCmbA%3D" title="2017天猫618">
                                <img src="https://img.alicdn.com/tfs/TB1_phpRpXXXXaTXVXXXXXXXXXX-440-180.jpg" height="180" width="440" alt="2017天猫618" />
                            </a>

                        </div>

                        <div>




                        </div>

                        <div>



                            <div style="padding: 10px 0; margin: 20px auto; width: 90%; text-align: center;">
                                <div>enjoy?donate!</div>
                                <button id="rewardButton" disable="enable" onclick="var qr = document.getElementById('QR'); if (qr.style.display === 'none') {qr.style.display='block';} else {qr.style.display='none'}">
                                    <span>赏</span>
                                </button>
                                <div id="QR" style="display: none;">

                                    <div id="wechat" style="display: inline-block">
                                        <img id="wechat_qr" src="http://oqcey66z7.bkt.clouddn.com/public/images/wechat.png" alt="小英雄雨来 WeChat Pay"/>
                                        <p>微信打赏</p>
                                    </div>


                                    <div id="alipay" style="display: inline-block">
                                        <img id="alipay_qr" src="http://oqcey66z7.bkt.clouddn.com/public/images/alipay.png" alt="小英雄雨来 Alipay"/>
                                        <p>支付宝打赏</p>
                                    </div>

                                </div>
                            </div>



                        </div>

                        <div>


                            <ul class="post-copyright">
                                <li class="post-copyright-author">
                                    <strong>本文作者：</strong>
                                    小英雄雨来
                                </li>
                                <li class="post-copyright-link">
                                    <strong>本文链接：</strong>
                                    <a href="http://xcoder.me/2017-05/architecture/系统架构演进/" title="一个业务系统的架构设计">http://xcoder.me/2017-05/architecture/系统架构演进/</a>
                                </li>
                                <li class="post-copyright-license">
                                    <strong>版权声明： </strong>
                                    本博客所有文章除特别声明外，均采用 <a href="https://creativecommons.org/licenses/by-nc-nd/4.0/" rel="external nofollow" target="_blank">知识共享署名-非商业性使用-禁止演绎 4.0 国际许可协议</a> 许可协议。转载请注明出处！
                                </li>
                            </ul>



                        </div>

                        <footer class="post-footer">

                            <div class="post-tags">

                                <a href="/tags/架构设计/" rel="tag"># 架构设计</a>

                                <a href="/tags/SAAS/" rel="tag"># SAAS</a>

                                <a href="/tags/互联网应用架构/" rel="tag"># 互联网应用架构</a>

                            </div>







                            <div class="post-nav">
                                <div class="post-nav-next post-nav-item">

                                    <a href="/2017-05/build/General-SSL-Problem/" rel="next" title="General SSL Problem总结">
                                        <i class="fa fa-chevron-left"></i> General SSL Problem总结
                                    </a>

                                </div>

                                <span class="post-nav-divider"></span>

                                <div class="post-nav-prev post-nav-item">

                                    <a href="/2017-05/life/2B和2C站点的区别/" rel="prev" title="2B和2C站点的区别">
                                        2B和2C站点的区别 <i class="fa fa-chevron-right"></i>
                                    </a>

                                </div>
                            </div>




                        </footer>
                    </article>



                    <div class="post-spread">

                        <!-- JiaThis Button BEGIN -->
                        <div class="jiathis_style">
                            <a class="jiathis_button_tsina"></a>
                            <a class="jiathis_button_tqq"></a>
                            <a class="jiathis_button_weixin"></a>
                            <a class="jiathis_button_cqq"></a>
                            <a class="jiathis_button_douban"></a>
                            <a class="jiathis_button_renren"></a>
                            <a class="jiathis_button_qzone"></a>
                            <a class="jiathis_button_kaixin001"></a>
                            <a class="jiathis_button_copy"></a>
                            <a href="http://www.jiathis.com/share" class="jiathis jiathis_txt jiathis_separator jtico jtico_jiathis" target="_blank"></a>
                            <a class="jiathis_counter_style"></a>
                        </div>
                        <script type="text/javascript" >
                            var jiathis_config={
                                hideMore:false
                            }
                        </script>
                        <script type="text/javascript" src="http://v3.jiathis.com/code/jia.js" charset="utf-8"></script>
                        <!-- JiaThis Button END -->


                    </div>
                </div>


            </div>





            <div class="comments" id="comments">

            </div>


        </div>



        <div class="sidebar-toggle">
            <div class="sidebar-toggle-line-wrap">
                <span class="sidebar-toggle-line sidebar-toggle-line-first"></span>
                <span class="sidebar-toggle-line sidebar-toggle-line-middle"></span>
                <span class="sidebar-toggle-line sidebar-toggle-line-last"></span>
            </div>
        </div>

        <aside id="sidebar" class="sidebar">
            <div class="sidebar-inner">




                <ul class="sidebar-nav motion-element">
                    <li class="sidebar-nav-toc sidebar-nav-active" data-target="post-toc-wrap" >
                        文章目录
                    </li>
                    <li class="sidebar-nav-overview" data-target="site-overview">
                        站点概览
                    </li>
                </ul>


                <section class="site-overview sidebar-panel">
                    <div class="site-author motion-element" itemprop="author" itemscope itemtype="http://schema.org/Person">
                        <img class="site-author-image" itemprop="image"
                             src="/images/avatar.gif"
                             alt="小英雄雨来" />
                        <p class="site-author-name" itemprop="name">小英雄雨来</p>

                        <p class="site-description motion-element" itemprop="description"></p>

                    </div>
                    <nav class="site-state motion-element">


                        <div class="site-state-item site-state-posts">
                            <a href="/archives">
                                <span class="site-state-item-count">16</span>
                                <span class="site-state-item-name">日志</span>
                            </a>
                        </div>





                        <div class="site-state-item site-state-categories">
                            <a href="/categories/index.html">
                                <span class="site-state-item-count">8</span>
                                <span class="site-state-item-name">分类</span>
                            </a>
                        </div>





                        <div class="site-state-item site-state-tags">
                            <a href="/tags/index.html">
                                <span class="site-state-item-count">39</span>
                                <span class="site-state-item-name">标签</span>
                            </a>
                        </div>


                    </nav>



                    <div class="links-of-author motion-element">

                    </div>






                    <div class="links-of-blogroll motion-element links-of-blogroll-inline">
                        <div class="links-of-blogroll-title">
                            <i class="fa  fa-fw fa-globe"></i>
                            收藏
                        </div>
                        <ul class="links-of-blogroll-list">

                            <li class="links-of-blogroll-item">
                                <a href="http://news.dbanotes.net/" title="dbanotes" target="_blank">dbanotes</a>
                            </li>

                            <li class="links-of-blogroll-item">
                                <a href="http://hedengcheng.com/" title="数据库" target="_blank">数据库</a>
                            </li>

                            <li class="links-of-blogroll-item">
                                <a href="http://www.ruanyifeng.com/blog/" title="ruanyifeng" target="_blank">ruanyifeng</a>
                            </li>

                            <li class="links-of-blogroll-item">
                                <a href="https://readhub.me/" title="readhub" target="_blank">readhub</a>
                            </li>

                            <li class="links-of-blogroll-item">
                                <a href="https://www.thoughtworks.com/cn/radar" title="技术雷达" target="_blank">技术雷达</a>
                            </li>

                        </ul>
                    </div>





                </section>


                <!--noindex-->
                <section class="post-toc-wrap motion-element sidebar-panel sidebar-panel-active">
                    <div class="post-toc">






                        <div class="post-toc-content"><ol class="nav"><li class="nav-item nav-level-2"><a class="nav-link" href="#技术选型"><span class="nav-number">1.</span> <span class="nav-text">技术选型</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#架构演进"><span class="nav-number">2.</span> <span class="nav-text">架构演进</span></a></li></ol></div>


                    </div>
                </section>
                <!--/noindex-->




            </div>
        </aside>



    </div>
</main>
