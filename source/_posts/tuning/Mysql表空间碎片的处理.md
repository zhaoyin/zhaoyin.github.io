
---
title: Mysql表空间碎片的处理
date: 2017-09-20 21:40:46
reward: true
categories:
    - tuning
tags: 
    - MySQL
---

表空间碎片，指的是MySQL InnoDB引擎的表空间碎片；

## 产生原因

表空间碎片产生的常见原因：

* 记录被Delete，且原空间无法复用；
    一般空间碎片大的都是表中记录被大面积删除。

* 记录被Update（通常出现在变长字段中），原空间无法复用；
    一般是对含有可变长度行的表（含有VARCHAR, BLOB或TEXT列的表）进行了很多更改

* 记录插入导致页分裂，页的填充率降低；

## 影响

如果表空间比较大，且表空间碎片较大，可能带来的负面影响：

* 浪费磁盘空间；

* 可能导致查询扫描的IO成本提升，效率降低；

如果表空间较小或者碎片率较小，用户无需关注，也不建议执行回收空间碎片操作。

## 回收表空间碎片的方法

* 在多数的设置中，您根本不需要运行OPTIMIZE TABLE。
    即使您对可变长度的行进行了大量的更新，您也不需要经常运行，每月一次即可，只对特定的表运行。
* OPTIMIZE TABLE只对MyISAM, BDB和InnoDB表起作用。
* 注意，在OPTIMIZE TABLE运行过程中，MySQL会**锁定表**。

* 也可以考虑``alter table tableName Engine='InnoDB';``这种方式来整理

* 回收空间虽然对大表查询有一定程序的优化，能够降低IO成本，提高效率，但是这个动作耗性能且锁表，请在**业务低峰期**做。
